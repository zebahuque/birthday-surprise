<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Surprise</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="surprise-screen" role="main" aria-live="polite">
    <!-- We'll inject per-letter spans for animation with JS -->
    <h1 class="message" id="birthdayMessage">happy birthday,</h1>
    <h1 class="message" id="birthdayMessageName">binh!</h1>

  </main>

  <script src="script.js"></script>
  <script>
    // Split the heading into spans so each letter can animate separately
    (function () {
      const el = document.getElementsByClassName('surprise-screen');
      const text = el.textContent || '';
      el.innerHTML = ''; // clear

      // Create a span for each character including spaces (use &nbsp; for visible spaces)
      Array.from(text).forEach((ch, idx) => {
        const span = document.createElement('span');
        span.setAttribute('aria-hidden', 'true');
        span.style.setProperty('--i', idx);
        span.textContent = ch === ' ' ? '\u00A0' : ch;
        el.appendChild(span);
      });

      // Trigger the intro animation when the page loads IF the user came from index (gesture recorded),
      // otherwise still add the blinking color animation but skip the big intro to avoid jarring transitions.
      const shouldPlayIntro = (function () {
        try {
          return sessionStorage.getItem('playMusicOnLoad') === '1';
        } catch (e) {
          return false;
        }
      })();

      // Force a small timeout to ensure DOM paints so the intro animation runs smoothly
      requestAnimationFrame(() => {
        if (shouldPlayIntro) {
          // Add 'play' to run the intro shrink+spin animation once
          el.classList.add('play');
          // Clear the session flag so reloading doesn't replay unintentionally
          try { sessionStorage.removeItem('playMusicOnLoad'); } catch (e) {}
        }
      });

      // Optional: if you plan to play music, begin playback here if gesture was recorded.
      // If you have an <audio> element, you can call audio.play() here when shouldPlayIntro is true.
    })();
  </script>
</body>
</html>